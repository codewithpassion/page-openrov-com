"use strict";function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}return step("next")})}}function objectifyForm(formArray){for(var returnArray={},i=0;i<formArray.length;i++)returnArray[formArray[i].name]=formArray[i].value;return returnArray}function getData(formData,variants){var variant=getVariant(formData,variants),address={first_name:formData.firstName,last_name:formData.lastName,company:null,line1:formData.address1,line2:formData.address2,city:formData.city,state:"US"===formData.country?formData.usState:formData.state,zip:formData.zip,country:formData.country.toLowerCase(),phone:formData.phone};return{user_id:"5637c8d966e9ec03008989ef",buyer:{email:formData.email,first_name:formData.firstName,last_name:formData.lastName,phone:formData.phone,notes:formData.notes},shipping_address:address,billing_address:Object.assign({},address,{zip:formData.billingZip}),line_items:[{product_id:PRODUCT,variant_id:variant,quantity:parseInt(formData.quantity)}],payment_source:{card:{name:formData.firstName+" "+formData.lastName,number:formData.ccNumber,exp_month:formData.expDate.split("/")[0],exp_year:formData.expDate.split("/")[1],cvc:formData.cvc}},discount_codes:[]}}function getVariant(formData,variants){var selectedVariants=[];for(var item in formData)item.startsWith("option_")&&selectedVariants.push(formData[item]);selectedVariants=selectedVariants.sort();var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=variants[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var v=_step.value;if(v.options.ids.sort().join()===selectedVariants.join())return v.id}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}var calculateShipping=function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(form,variants){var formData,data,result;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return formData=objectifyForm(form.serializeArray()),data=getData(formData,variants),form.find(".loading").show(),_context.next=5,$.ajax({async:!0,crossDomain:!0,url:"https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/calculate-shipping",method:"POST",headers:{"content-type":"application/json"},processData:!1,data:JSON.stringify(data)});case 5:result=_context.sent,form.find("#shipping").val("$"+(result.shipping/100).toFixed(2)),form.find("#subtotal").val("$"+(result.subtotal/100).toFixed(2)),form.find("#tax").val("$"+(result.taxes/100).toFixed(2)),form.find("#total").val("$"+(result.total/100).toFixed(2)),form.find(".loading").hide();case 11:case"end":return _context.stop()}},_callee,this)}));return function(_x,_x2){return _ref.apply(this,arguments)}}(),PRODUCT="57e9bd02726ecc1100f4204a";_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){var result,optionsHtml,orderForm,variants;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,$.ajax({url:"https://wt-f938a32f745f3589d64a35c208dd4c79-0.run.webtask.io/celry-access/products/"+PRODUCT});case 2:result=_context3.sent,$("#description").html(result.data.description),optionsHtml=result.data.options.map(function(o){return'<div class="form-group row"><label for="'+o.id+'" class="col-2 col-form-label">'+o.name+':</label><select class="form-control form-control-danger col-6" id="option_'+o.id+'" name="option_'+o.id+'" required><option selected value="" disabled>Select '+o.name+"</option>"+o.values.map(function(v){return'<option value="'+v.id+'">'+v.name+"</option>"}).join("")+"</select></div>"}).join(""),orderForm=$("form#orderForm"),orderForm.find("#options").append(optionsHtml),orderForm.find('#country option[value="US"]').attr("selected","true"),orderForm.find("#country").change(function(ev){"US"===ev.currentTarget.options[ev.target.selectedIndex].value?(orderForm.find("#usState").removeClass("hidden-xs-up"),orderForm.find("#state").addClass("hidden-xs-up")):(orderForm.find("#state").removeClass("hidden-xs-up"),orderForm.find("#usState").addClass("hidden-xs-up")),calculateShipping(orderForm,result.data.variants)}),orderForm.find("#options select").change(function(ev){calculateShipping(orderForm,result.data.variants)}),orderForm.find("#quantity").change(function(ev){calculateShipping(orderForm,result.data.variants)}),orderForm.find("#ccNumber").keypress(function(event){String.fromCharCode(event.which).match(/[0-9- ]/)||event.preventDefault()}),variants=result.data.variants,orderForm.on("submit",function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(ev){var formData,data,result;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return ev.preventDefault(),orderForm.find('button[type="submit"]').attr("disabled",!0),formData=objectifyForm(orderForm.serializeArray()),data=getData(formData,variants),_context2.next=6,$.ajax({async:!0,crossDomain:!0,url:"https://api.trycelery.com/v2/orders/checkout",method:"POST",headers:{"content-type":"application/json"},processData:!1,data:JSON.stringify(data)});case 6:result=_context2.sent,console.log(result);case 8:case"end":return _context2.stop()}},_callee2,void 0)}));return function(_x3){return _ref3.apply(this,arguments)}}()),$("#orderFormContainer").removeClass("invisible"),$("#loader-wrapper").addClass("loaded");case 16:case"end":return _context3.stop()}},_callee3,void 0)}))();